<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RADIO IVANPLAY ESPA√ëA ‚Äî 24/7</title>
<meta name="description" content="Radio IVANPLAY ‚Äî AutoDJ 24/7 con m√∫sica variada. Chat interno, banner √©pico y estilo morado gaming. Con publicidad y audio-ads." />
<style>
  :root{
    --bg:#0b0d12; --card:#121725; --text:#e7ecf3; --muted:#94a0b8;
    --a:#8b5cf6; --a2:#5b3dff; --ok:#14f195; --chip:#1b2340; --neon:#1fb6ff;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 800px at 110% -10%,rgba(139,92,246,.18),transparent),
      radial-gradient(900px 600px at -10% 120%,rgba(91,61,255,.12),transparent),
      var(--bg);
    color:var(--text); font-family:system-ui,Segoe UI,Roboto,Inter,Arial;
  }
  .wrap{max-width:1100px;margin:0 auto;padding:22px}
  .card{
    background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.25)
  }

  /* ====== BANNER ====== */
  .hero{
    position:relative; border-radius:22px; overflow:hidden;
    height:280px; margin:18px 0; display:grid; place-items:center;
    background:
      linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.65)),
      radial-gradient(1000px 600px at -10% 120%,rgba(31,182,255,.20),transparent 60%),
      radial-gradient(900px 500px at 110% -10%,rgba(139,92,246,.25),transparent 60%),
      var(--bg);
    background-size:cover; background-position:center;
  }
  .hero.has-image{
    background-image:
      linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.65)),
      var(--hero-image);
  }
  .hero-inner{ text-align:center; padding:0 16px }
  .neon{
    font-family: Impact, Haettenschweiler, 'Arial Black', sans-serif;
    font-size: clamp(28px, 5vw, 54px);
    color: var(--neon);
    text-shadow:
      0 0 6px  rgba(31,182,255,.9),
      0 0 16px rgba(31,182,255,.7),
      0 0 36px rgba(31,182,255,.55),
      0 0 64px rgba(31,182,255,.35);
    margin:0 0 6px;
    letter-spacing:.5px;
  }
  .neon-sub{color:#cfe9ff;font-weight:700;letter-spacing:2px;text-transform:uppercase}

  header.card{display:flex;gap:16px;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:12px}
  .brand .logo{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,#6a5cf6,#24d3ee)}
  .title{margin:0;font-size:28px}
  .muted{color:var(--muted)}
  .live{display:flex;align-items:center;gap:8px;font-size:12px;padding:5px 10px;border:1px solid rgba(255,255,255,.2);border-radius:999px}
  .dot{width:10px;height:10px;border-radius:50%;background:#16f195;box-shadow:0 0 8px #16f195;animation:pulse 1.5s infinite}
  @keyframes pulse{0%{transform:scale(.9);opacity:.8}50%{transform:scale(1);opacity:1}100%{transform:scale(.9);opacity:.8}}

  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:18px}
  @media (max-width:950px){.grid{grid-template-columns:1fr}}

  .btn{cursor:pointer;border:none;padding:11px 14px;border-radius:12px;background:rgba(255,255,255,.06);color:var(--text);font-weight:700;border:1px solid rgba(255,255,255,.12)}
  .btn.primary{background:linear-gradient(180deg,var(--a),var(--a2));border:none;box-shadow:0 10px 24px rgba(139,92,246,.35)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  input[type="text"],textarea{width:100%;background:#0a0f1c;color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px}
  input[type="range"]{width:180px}
  #now{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
  #chatLog{height:280px;overflow:auto;background:#0a0f1c;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px}
  .msg{margin:4px 0}
  #emoji{max-height:120px;overflow:auto;display:grid;grid-template-columns:repeat(10, 1fr);gap:6px}
  #emoji button{background:#1a2236;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:6px;cursor:pointer}
  .emoji-font,#emoji button,#chatLog,#msg,#nick{
    font-family:"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",system-ui,"Segoe UI",Roboto,Arial,sans-serif;font-size:16px;line-height:1.15
  }

  footer{color:var(--muted);text-align:center;margin-top:16px}
  .socials{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media (max-width:580px){.socials{grid-template-columns:1fr}}
  .soc{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;background:#0a0f1c;border:1px solid rgba(255,255,255,.08);text-decoration:none;color:var(--text);font-weight:700}
  .soc small{color:var(--muted);font-weight:500}
  .soc.disabled{opacity:.55;cursor:not-allowed;border-style:dashed}
  .soc .ico{width:22px;height:22px;display:inline-grid;place-items:center}
  .soc .txt{display:flex;flex-direction:column;line-height:1.15}
  .chips{display:flex;flex-wrap:wrap;gap:10px}
  .chip{background:var(--chip);border:1px solid rgba(36,211,238,.35);color:#cfefff;padding:6px 12px;border-radius:999px}

  /* tama√±o est√°ndar para im√°genes emoji */
  .emo { width:20px; height:20px; vertical-align:-3px; }
  .adtag{color:var(--muted);font-size:12px;margin-top:6px;text-align:center}
</style>
</head>
<body>
<div class="wrap">

  <!-- BANNER (usa imagen si existe) -->
  <section id="hero" class="hero">
    <div class="hero-inner">
      <h1 class="neon">RADIO IVANPLAY ESPA√ëA</h1>
      <div class="neon-sub">24/7 MUSIC EXPERIENCE</div>
    </div>
  </section>

  <!-- Publicidad est√°tica: bloque grande debajo del banner -->
  <section class="card" style="margin:12px 0">
    <a href="https://tu-enlace-del-anunciante.example" target="_blank" rel="noopener" style="display:block;text-align:center">
      <img src="./assets/ads/banner_top_970x250.jpg" alt="Publicidad" style="max-width:100%;height:auto;border-radius:12px">
    </a>
    <div class="adtag">Publicidad</div>
  </section>

  <header class="card">
    <div class="brand">
      <div class="logo">üéß</div>
      <div>
        <h2 class="title" style="margin:0">Mi Radio Online</h2>
        <div class="muted">AutoDJ 24/7 ‚Ä¢ Chat interno ‚Ä¢ <span id="clock" title="Hora de Madrid (Europe/Madrid)"></span></div>
      </div>
    </div>
    <div class="live"><span class="dot"></span> EN VIVO</div>
  </header>

  <!-- REPRODUCTOR + CHAT -->
  <section class="grid">
    <div class="card" id="playerCard">
      <h2 style="margin:4px 0 10px">Reproductor en vivo</h2>
      <div class="row">
        <button id="playBtn" class="btn primary">‚ñ∂ Reproducir</button>
        <button id="stopBtn" class="btn">‚ñ† Detener</button>
        <button id="prevBtn" class="btn">‚èÆ</button>
        <button id="nextBtn" class="btn">‚è≠</button>
        <label class="muted" style="display:flex;align-items:center;gap:8px">Volumen
          <input id="vol" type="range" min="0" max="1" step="0.01" value="0.8">
        </label>
      </div>
      <p class="muted" id="status">Cargando playlist‚Ä¶</p>
      <p id="now">‚Äî</p>
      <audio id="audio" preload="none" crossorigin="anonymous"></audio>
      <div id="gate" class="row" style="display:none;margin-top:8px">
        <span class="muted">Pulsa para iniciar audio</span>
        <button id="startBtn" class="btn primary">Iniciar</button>
      </div>
      <p class="muted" style="margin-top:10px">Este stream puede incluir mensajes promocionales (audio-ads).</p>
    </div>

    <div>
      <div class="card">
        <h2 style="margin:4px 0 10px">Chat</h2>
        <div id="chatLog" class="emoji-font"></div>
        <div class="row" style="margin-top:8px">
          <input id="nick" type="text" placeholder="Tu nick" style="max-width:220px" class="emoji-font">
          <button id="saveNick" class="btn">Guardar</button>
        </div>
        <div class="row" style="margin-top:8px">
          <textarea id="msg" rows="2" placeholder="Escribe un mensaje‚Ä¶" class="emoji-font"></textarea>
          <button id="send" class="btn primary">Enviar</button>
        </div>
        <div id="emoji" style="margin-top:6px" class="emoji-font"></div>
        <p class="muted">Atajos: escribe <code>:ivanheadset:</code> o <code>:ivangame:</code> para usar los exclusivos.</p>
        <p class="muted">Chat interno en esta p√°gina. El historial se guarda en tu navegador.</p>
      </div>

      <!-- Publicidad est√°tica: bloque en columna chat -->
      <section class="card" style="margin-top:12px;text-align:center">
        <a href="https://tu-otro-anunciante.example" target="_blank" rel="noopener" style="display:block">
          <img src="./assets/ads/sidebar_300x250.jpg" alt="Publicidad" style="max-width:100%;height:auto;border-radius:12px">
        </a>
        <div class="adtag">Publicidad</div>
      </section>
    </div>
  </section>

  <!-- REDES + G√âNEROS -->
  <section class="grid" style="margin-top:18px">
    <div class="card">
      <h2 style="margin:4px 0 12px">S√≠gueme</h2>
      <div class="socials" id="socials"></div>
    </div>
    <div class="card">
      <h2 style="margin:4px 0 12px">Emisi√≥n 24/7</h2>
      <p class="muted">M√∫sica variada las 24 horas del d√≠a. G√©neros habituales:</p>
      <div class="chips" id="chips"></div>
    </div>
  </section>

  <footer>¬© <span id="year"></span> RADIO IVANPLAY ¬∑ Hecho con ‚ô•</footer>
</div>

<script>
/* ================== CONFIG ================== */
const CONFIG = {
  PLAYLIST_JSON_URL: "./music/playlist.json",     // tu lista principal
  ADS_JSON_URL: "./music/anuncios.json",          // promos de audio (si no existe, se ignoran)
  AUDIO_ADS_EVERY: 4,                              // inserta 1 anuncio cada N canciones
  SHUFFLE: true,
  BANNER_URL: "./assets/banner.jpg",
  TW_BASE: "./assets/twemoji/",

  SOCIALS: [
    {name:"YouTube",   icon:"‚ñ∂Ô∏è", url:"https://www.youtube.com/@ivanplays8012"},
    {name:"Twitch",    icon:"üéÆ", url:"https://www.twitch.tv/ivanplays_offi"},
    {name:"SoundCloud",icon:"‚òÅÔ∏è", url:"https://soundcloud.com/ivanzombiz"}
  ],
  GENRES: ["Hardbass","Reggaeton","Electr√≥nica (EDM)","Deep House","Tech House","Hip Hop/Rap"]
};

/* Emojis exclusivos (SVG locales) */
const CUSTOM_EMOJIS = [
  { short: ":ivanheadset:", src: "./assets/custom/ivan_headset.svg",   title: "Headset IVANPLAY" },
  { short: ":ivangame:",    src: "./assets/custom/ivan_controller.svg", title: "Gamepad IVANPLAY" }
];

/* ===== Emojis locales (sin twemoji.parse, a prueba de balas) ===== */
const EMO_EXT = ".png";                       // cambia a ".svg" si subes todos como SVG
const TW_BASE = CONFIG.TW_BASE;               // "./assets/twemoji/"
const EMO_UNI = "üòÄüòÅüòÇü§£üòäüòâüòçüòòüòéüôÇü§îüôÉüò¥üòáüò°üò≠üôåüëèüëçüî•üéßüéµüé∂üé§üéºüéπü•Åüé∑üé∫üé∏".split("");
function codepoints(chr){ return Array.from(chr).map(c=>c.codePointAt(0).toString(16)).join("-"); }
const EMO_MAP = Object.fromEntries(EMO_UNI.map(e => [e, `${TW_BASE}${codepoints(e)}${EMO_EXT}`]));

/* ============================================ */

const $ = s => document.querySelector(s);
document.getElementById("year").textContent = new Date().getFullYear();

/* Banner: usa imagen si existe */
(function(){
  const hero = $("#hero");
  if(CONFIG.BANNER_URL){ hero.style.setProperty("--hero-image", `url('${CONFIG.BANNER_URL}')`); hero.classList.add("has-image"); }
})();

/* Reloj Europe/Madrid */
(function clock(){
  const el = $("#clock");
  function tick(){
    const fmt = new Intl.DateTimeFormat('es-ES',{timeZone:'Europe/Madrid',hour:'2-digit',minute:'2-digit',second:'2-digit',weekday:'short',day:'2-digit',month:'short'});
    el.textContent = fmt.format(new Date()) + " (Madrid)";
  }
  tick(); setInterval(tick, 1000);
})();

/* Helpers */
function baseName(u){ try{const p=new URL(u,location.href); return decodeURIComponent(p.pathname.split('/').pop());}catch{return u;} }
function setStatus(msg, ok){ const el=$("#status"); el.textContent = msg; el.style.color = ok ? "#14f195" : "#ff7777"; }
function enc(u){
  try{ const url=new URL(u,location.origin); url.pathname=url.pathname.split('/').map(encodeURIComponent).join('/'); return url.toString().replace(location.origin,""); }
  catch{ return u.split('/').map((seg,i)=> i===0?seg:encodeURIComponent(seg)).join('/'); }
}

/* ================== PLAYER + AUDIO-ADS ================== */
const audio=$("#audio"), now=$("#now"), playBtn=$("#playBtn"), stopBtn=$("#stopBtn"), prevBtn=$("#prevBtn"), nextBtn=$("#nextBtn"), vol=$("#vol"), gate=$("#gate"), startBtn=$("#startBtn");
let playlist=[], ads=[], mixed=[], i=0;

function isAudio(u){ return /\.(mp3|wav|aac|m4a|ogg)$/i.test((u||'').split('?')[0]); }

async function fetchJSONSafe(url){
  try{
    const r = await fetch(url, {cache:"no-store"});
    if(!r.ok) return null;
    return await r.json();
  }catch{ return null; }
}

async function loadPlaylist(){
  const pl = await fetchJSONSafe(CONFIG.PLAYLIST_JSON_URL);
  if(!Array.isArray(pl) || !pl.length){ setStatus("playlist.json est√° vac√≠o o mal formateado", false); return; }

  const main = pl.filter(isAudio).map(u=>enc(u));
  if(CONFIG.SHUFFLE && main.length>1){
    for(let k=main.length-1;k>0;k--){ const j=Math.floor(Math.random()*(k+1)); [main[k],main[j]]=[main[j],main[k]]; }
  }

  // anuncios opcionales
  const adsJson = await fetchJSONSafe(CONFIG.ADS_JSON_URL);
  ads = Array.isArray(adsJson) ? adsJson.filter(isAudio).map(u=>enc(u)) : [];

  // mezcla: cada N canciones, inserta 1 anuncio aleatorio de ads (si hay)
  mixed = [];
  const N = Math.max(2, parseInt(CONFIG.AUDIO_ADS_EVERY||4,10)); // m√≠nimo cada 2 para no saturar
  let count=0;
  for(const track of main){
    mixed.push({url:track, type:"music"});
    count++;
    if(ads.length && count>=N){
      const pick = ads[Math.floor(Math.random()*ads.length)];
      mixed.push({url:pick, type:"ad"});
      count=0;
    }
  }
  playlist = mixed.length ? mixed : main.map(u=>({url:u,type:"music"}));

  i=0;
  setStatus(`Playlist cargada (${main.length} pistas${ads.length?` + ${ads.length} anuncios`:''})`, true);
  setTrack(i);
  setTimeout(tryAutoplay, 200);
}

function setTrack(idx){
  if(!playlist.length) return;
  i = (idx + playlist.length) % playlist.length;
  const item = playlist[i];
  audio.src = item.url;
  now.textContent = (item.type==="ad" ? "Anuncio: " : "Reproduciendo: ") + baseName(item.url);
  const b=$("#skipErr"); if(b) b.remove();
}

async function play(){ try{ if(!audio.src) setTrack(0); await audio.play(); gate.style.display="none"; playBtn.textContent="‚è∏ Pausar"; playBtn.classList.remove("primary"); }catch{ gate.style.display="flex"; } }
function pause(){ audio.pause(); playBtn.textContent="‚ñ∂ Reproducir"; playBtn.classList.add("primary"); }
function next(){ if(!playlist.length) return; setTrack(i+1); play(); }
function prev(){ if(!playlist.length) return; setTrack(i-1); play(); }
async function tryAutoplay(){ try{ await play(); }catch{} }

playBtn.addEventListener("click", ()=> audio.paused ? play() : pause());
stopBtn.addEventListener("click", ()=>{ audio.pause(); audio.currentTime=0; playBtn.textContent="‚ñ∂ Reproducir"; playBtn.classList.add("primary"); });
prevBtn.addEventListener("click", prev);
nextBtn.addEventListener("click", next);
startBtn.addEventListener("click", play);
vol.addEventListener("input", ()=> audio.volume=parseFloat(vol.value||"0.8"));
audio.volume=parseFloat(vol.value||"0.8");
audio.addEventListener("ended", next);
audio.addEventListener("error", ()=>{
  let d=""; try{ if(audio.error){ const m={1:"ABORTED",2:"NETWORK",3:"DECODE",4:"SRC_NOT_SUPPORTED"}; d=m[audio.error.code]||`ERR ${audio.error.code}`; } }catch{}
  setStatus(`Fallo al reproducir: ${baseName(audio.src)}${d? " ¬∑ "+d:""}`, false);
  if(!$("#skipErr")){ const b=document.createElement("button"); b.id="skipErr"; b.className="btn"; b.style.marginLeft="8px"; b.textContent="Saltar error y continuar ‚è≠"; b.onclick=()=>{ b.remove(); next(); }; $("#status").after(b); }
});
document.addEventListener("visibilitychange", ()=>{ if(document.visibilityState==="visible" && audio.paused){ tryAutoplay(); } });

loadPlaylist();

/* ===== CHAT + EMOJIS (locales y exclusivos) ===== */
const log=$("#chatLog"), send=$("#send"), msg=$("#msg"), nick=$("#nick"), saveNick=$("#saveNick"), emojiBox=$("#emoji");

/* Picker: Twemoji locales + exclusivos (inyectados como <img>) */
function renderEmojiButtons(){
  emojiBox.innerHTML="";
  // Twemoji locales
  EMO_UNI.forEach(e=>{
    const b=document.createElement("button"); b.className="emoji-font";
    const img=document.createElement("img");
    img.alt=e; img.width=20; img.height=20; img.decoding="async";
    img.src = EMO_MAP[e];                   // ./assets/twemoji/1f600.png, etc.
    img.onerror = ()=>{ b.textContent=e; }; // fallback a texto si faltara el archivo
    b.appendChild(img);
    b.onclick=()=>{ msg.value+=e; msg.focus(); };
    emojiBox.appendChild(b);
  });
  // Exclusivos (SVG)
  CUSTOM_EMOJIS.forEach(e => {
    const b = document.createElement("button");
    const img = document.createElement("img");
    img.src = e.src; img.alt = e.short; img.width = 20; img.height = 20; img.decoding="async";
    b.appendChild(img);
    b.title = e.title;
    b.onclick = ()=>{ msg.value += " " + e.short + " "; msg.focus(); };
    emojiBox.appendChild(b);
  });
}
renderEmojiButtons();

/* Chat local + BroadcastChannel + reemplazo manual de emojis */
const CH_KEY="ivanplay_chat_v1"; const bc=("BroadcastChannel" in window)? new BroadcastChannel("ivanplay_chat_v1"):null;
function getNick(){ let n=(nick.value||"").trim(); if(!n){ n=localStorage.getItem("ivanplay_nick")||("User"+Math.floor(Math.random()*900+100)); nick.value=n; } return n; }
function saveNickLS(){ localStorage.setItem("ivanplay_nick", getNick()); append({t:new Date().toLocaleTimeString(),u:"Sistema",m:"Nick guardado: "+getNick(),sys:true}); }
saveNick.addEventListener("click", saveNickLS); nick.value=localStorage.getItem("ivanplay_nick")||"";

function append(o){
  const p=document.createElement("div"); p.className="msg"+(o.sys?" sys":"");
  // texto base
  let html = `[${o.t}] ${o.u}: ${o.m}`;

  // 1) Shortcodes exclusivos -> <img svg>
  CUSTOM_EMOJIS.forEach(e => {
    const re = new RegExp(e.short.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&'), "g");
    html = html.replace(re, `<img class="emo" src="${e.src}" alt="${e.short}">`);
  });

  // 2) Emojis unicode (los 30) -> <img local> (PNG o SVG seg√∫n EMO_EXT)
  EMO_UNI.forEach(e => {
    const re = new RegExp(e.replace(/([.*+?^${}()|[\]\\\\])/g, '\\$1'), "g");
    html = html.replace(re, `<img class="emo" src="${EMO_MAP[e]}" alt="${e}">`);
  });

  p.innerHTML = html;
  log.appendChild(p); log.scrollTop=log.scrollHeight;
}
function loadChat(){ try{ (JSON.parse(localStorage.getItem(CH_KEY)||"[]")).slice(-200).forEach(append);}catch{} }
function store(o){ try{ const a=JSON.parse(localStorage.getItem(CH_KEY)||"[]"); a.push(o); localStorage.setItem(CH_KEY, JSON.stringify(a.slice(-300))); }catch{} }
function sendMsg(){ const m=(msg.value||"").trim(); if(!m) return; const o={t:new Date().toLocaleTimeString(),u:getNick(),m}; append(o); store(o); if(bc) bc.postMessage(o); msg.value=""; }
send.addEventListener("click", sendMsg);
msg.addEventListener("keydown", e=>{ if(e.key==="Enter" && (e.ctrlKey||e.metaKey)) sendMsg(); });
if(bc) bc.onmessage=ev=>{ if(ev&&ev.data) append(ev.data); };
append({t:new Date().toLocaleTimeString(),u:"Sistema",m:"Bienvenido al chat de RADIO IVANPLAY üôÇ",sys:true});

/* REDES + G√âNEROS */
const socials=$("#socials"), chips=$("#chips");
CONFIG.SOCIALS.forEach(s=>{
  const hasLink=!!(s.url&&s.url.trim()); const base=document.createElement(hasLink?"a":"div");
  base.className="soc emoji-font"+(hasLink?"":" disabled"); if(hasLink){ base.href=s.url; base.target="_blank"; base.rel="noopener"; }
  const host=hasLink? new URL(s.url).hostname : "Pr√≥ximamente";
  base.innerHTML=`<span class="ico">${s.icon}</span><div class="txt"><div>${s.name}</div><small>${host}</small></div>`;
  socials.appendChild(base);
});
CONFIG.GENRES.forEach(g=>{ const c=document.createElement("span"); c.className="chip"; c.textContent=g; chips.appendChild(c); });
</script>
</body>
</html>
